/*!
 * VisibleConsole v0.2
 * http://github.com/jamestomasino/visibleconsole.js
 *
 * Copyright (c) James Tomasino and Eric Emmons
 * MIT license
 *
 */

(function(a,b){"use strict";function c(){}c.browserVisibleConsole,c.browserLog,c.consoleEl,c.headerEl,c.consoleInnerEl,c.consoleContainerEl,c.consoleOutputEl,c.handleEl,c.fallBackIFrame,c._isEnabled=!1,c.enable=function(){c._isEnabled===!1&&(c._isEnabled=!0,c.consoleEl=b.getElementById("visibleconsole"),c.consoleEl||(c.consoleEl=b.createElement("div"),c.consoleEl.id="visibleconsole",b.body.appendChild(c.consoleEl)),c.headerEl=b.getElementById("visibleconsoleheader"),c.headerEl||(c.headerEl=b.createElement("div"),c.headerEl.id="visibleconsoleheader",c.headerEl.innerHTML="~VisibleConsole~",c.headerEl.onmousedown=c._startMoving,b.getElementById("visibleconsole").appendChild(c.headerEl)),c.consoleInnerEl=b.getElementById("visibleconsoleinner"),c.consoleInnerEl||(c.consoleInnerEl=b.createElement("div"),c.consoleInnerEl.id="visibleconsoleinner",b.getElementById("visibleconsole").appendChild(c.consoleInnerEl)),c.consoleContainerEl=b.getElementById("visibleconsolecontainer"),c.consoleContainerEl||(c.consoleContainerEl=b.createElement("div"),c.consoleContainerEl.id="visibleconsolecontainer",b.getElementById("visibleconsoleinner").appendChild(c.consoleContainerEl)),c.consoleOutputEl=b.getElementById("visibleconsoleoutput"),c.consoleOutputEl||(c.consoleOutputEl=b.createElement("div"),c.consoleOutputEl.id="visibleconsoleoutput",b.getElementById("visibleconsolecontainer").appendChild(c.consoleOutputEl)),c.handleEl=b.getElementById("visibleconsolehandle"),c.handleEl||(c.handleEl=b.createElement("div"),c.handleEl.id="visibleconsolehandle",c.handleEl.onmousedown=c._startResizing,b.getElementById("visibleconsole").appendChild(c.handleEl),c.handleEl.appendChild(c._createline(21,15,16,20)),c.handleEl.appendChild(c._createline(21,9,10,20))),c.fallBackIFrame=b.getElementById("visibleconsoleiframe"),c.fallBackIFrame||(c.fallBackIFrame=b.createElement("iframe"),c.fallBackIFrame.style.display="none",c.fallBackIFrame.id="visibleconsoleiframe",b.body.appendChild(c.fallBackIFrame)),c.browserVisibleConsole=c.fallBackIFrame.contentWindow.console,Function.prototype.bind&&c.browserVisibleConsole&&"object"==typeof c.browserVisibleConsole.log&&(c.browserLog=Function.prototype.bind.call(c.browserVisibleConsole.log,c.browserVisibleConsole)),a.console={log:function(){for(var b,a="<span class='visibleconsolemessage'>",d=0;arguments.length>d;++d)if("string"==typeof arguments[d])a+=arguments[d],a+=arguments.length-1>d?" ":"\n";else try{b=""+arguments[d],a+=b,a+=arguments.length-1>d?" ":"\n"}catch(e){b=Object.prototype.toString.call(arguments[d]),a+=b,a+=arguments.length-1>d?" ":"\n"}a+="</span>",c.consoleOutputEl.innerHTML+=a,c.consoleOutputEl.scrollTop=c.consoleOutputEl.scrollHeight,c.browserLog&&c.browserVisibleConsole&&c.browserVisibleConsole.log&&c.browserLog.apply(null,arguments)}},a.onerror=function(b,c,d){return a.console.log('<span class="visibleconsoleerror">[ERROR] '+b+" ("+c+" Line: "+d+")</span>"),!0})},c.disable=function(){c._isEnabled===!0&&(c._isEnabled=!1,a.console=c.browserVisibleConsole,a.onerror=c.fallBackIFrame.contentWindow.onerror,c.consoleEl.parentNode.removeChild(c.consoleEl),c.fallBackIFrame.parentNode.removeChild(c.fallBackIFrame),c.consoleEl=null,c.fallBackIFrame=null,c.browserLog=null)},c._createline=function(a,c,d,e){var f=navigator.userAgent.indexOf("MSIE")>-1;if(a>d){var g=a;a=d,d=g,g=c,c=e,e=g}var h=b.createElement("div");h.className="visibleconsoleline";var i=Math.sqrt((a-d)*(a-d)+(c-e)*(c-e));if(h.style.width=i+"px",f){h.style.top=e>c?c+"px":e+"px",h.style.left=a+"px";var j=(d-a)/i,k=(e-c)/i;h.style.filter="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+j+", M12="+-1*k+", M21="+k+", M22="+j+")"}else{var l=Math.atan((e-c)/(d-a));h.style.top=c+.5*i*Math.sin(l)+"px",h.style.left=a-.5*i*(1-Math.cos(l))+"px",h.style.MozTransform=h.style.WebkitTransform=h.style.OTransform="rotate("+l+"rad)"}return h},c._stop=function(){b.onmouseup=function(){},b.onmousemove=function(){}},c._move=function(a,b){c.consoleEl.style.left=Math.max(a,0)+"px",c.consoleEl.style.top=Math.max(b,0)+"px"},c._resize=function(a,b){c.consoleEl.style.pixelWidth=a,c.consoleEl.style.pixelHeight=b,c.consoleEl.style.width=a+"px",c.consoleEl.style.height=b+"px";var d=c.consoleInnerEl.offsetHeight,e=c.headerEl.offsetHeight,f=d-e;c.consoleOutputEl.style.height=f+"px"},c._startMoving=function(d){if(d=d||a.event,3!=(d.keyCode||d.which)){c._stopDefault(d);var e=d.clientX,f=d.clientY,g=Number(c.consoleEl.style.top.replace("px","")),h=Number(c.consoleEl.style.left.replace("px","")),i=e-h,j=f-g;b.onmousemove=function(b){c._stopDefault(b),b=b||a.event;var d=b.clientX-i,e=b.clientY-j;c._move(d,e)},b.onmouseup=c._stop}},c._startResizing=function(d){if(d=d||a.event,3!=(d.keyCode||d.which)){c._stopDefault(d),d.clientX,d.clientY;var g=Number(c.consoleEl.style.top.replace("px","")),h=Number(c.consoleEl.style.left.replace("px",""));b.onmousemove=function(b){b=b||a.event,c._stopDefault(b);var d=b.clientX-h,e=b.clientY-g;c._resize(d,e)},b.onmouseup=c._stop}},c._stopDefault=function(b){return b&&b.preventDefault?b.preventDefault():a.event.returnValue=!1,!1},a.VisibleConsole=c})(window,document);
