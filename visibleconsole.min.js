/*!
 * VisibleConsole v0.3.1
 * http://github.com/jamestomasino/visibleconsole.js
 *
 * Copyright (c) James Tomasino
 *               Eric Emmons
 *               Stephen McDonald
 * MIT license
 *
 */

(function(m,n){"use strict";function VisibleConsole(){}VisibleConsole.browserVisibleConsole;VisibleConsole.browserLog;VisibleConsole.consoleEl;VisibleConsole.headerEl;VisibleConsole.consoleInnerEl;VisibleConsole.consoleContainerEl;VisibleConsole.consoleOutputEl;VisibleConsole.consoleInputEl;VisibleConsole.handleEl;VisibleConsole.fallBackIFrame;VisibleConsole._isEnabled=false;VisibleConsole.enable=function(){if(VisibleConsole._isEnabled===false){VisibleConsole._isEnabled=true;VisibleConsole.consoleEl=n.getElementById('visibleconsole');if(!VisibleConsole.consoleEl){VisibleConsole.consoleEl=n.createElement('div');VisibleConsole.consoleEl.id='visibleconsole';n.body.appendChild(VisibleConsole.consoleEl)}VisibleConsole.headerEl=n.getElementById('visibleconsoleheader');if(!VisibleConsole.headerEl){VisibleConsole.headerEl=n.createElement('div');VisibleConsole.headerEl.id='visibleconsoleheader';VisibleConsole.headerEl.innerHTML='~VisibleConsole~';VisibleConsole.headerEl.onmousedown=VisibleConsole._startMoving;VisibleConsole.headerEl.ontouchstart=VisibleConsole._startTouchMoving;n.getElementById('visibleconsole').appendChild(VisibleConsole.headerEl)}VisibleConsole.consoleInnerEl=n.getElementById('visibleconsoleinner');if(!VisibleConsole.consoleInnerEl){VisibleConsole.consoleInnerEl=n.createElement('div');VisibleConsole.consoleInnerEl.id='visibleconsoleinner';n.getElementById('visibleconsole').appendChild(VisibleConsole.consoleInnerEl)}VisibleConsole.consoleContainerEl=n.getElementById('visibleconsolecontainer');if(!VisibleConsole.consoleContainerEl){VisibleConsole.consoleContainerEl=n.createElement('div');VisibleConsole.consoleContainerEl.id='visibleconsolecontainer';n.getElementById('visibleconsoleinner').appendChild(VisibleConsole.consoleContainerEl)}VisibleConsole.consoleOutputEl=n.getElementById('visibleconsoleoutput');if(!VisibleConsole.consoleOutputEl){VisibleConsole.consoleOutputEl=n.createElement('div');VisibleConsole.consoleOutputEl.id='visibleconsoleoutput';n.getElementById('visibleconsolecontainer').appendChild(VisibleConsole.consoleOutputEl)}VisibleConsole.consoleInputEl=n.getElementById('visibleconsoleinput');if(!VisibleConsole.consoleInputEl){VisibleConsole.consoleInputEl=n.createElement('input');VisibleConsole.consoleInputEl.id='visibleconsoleinput';VisibleConsole.consoleInputEl.onkeypress=VisibleConsole._keyPress;n.getElementById('visibleconsolecontainer').appendChild(VisibleConsole.consoleInputEl)}VisibleConsole.handleEl=n.getElementById('visibleconsolehandle');if(!VisibleConsole.handleEl){VisibleConsole.handleEl=n.createElement('div');VisibleConsole.handleEl.id='visibleconsolehandle';VisibleConsole.handleEl.onmousedown=VisibleConsole._startResizing;VisibleConsole.handleEl.ontouchstart=VisibleConsole._startTouchResizing;n.getElementById('visibleconsole').appendChild(VisibleConsole.handleEl);VisibleConsole.handleEl.appendChild(VisibleConsole._createline(21,15,16,20));VisibleConsole.handleEl.appendChild(VisibleConsole._createline(21,9,10,20))}VisibleConsole.fallBackIFrame=n.getElementById('visibleconsoleiframe');if(!VisibleConsole.fallBackIFrame){VisibleConsole.fallBackIFrame=n.createElement('iframe');VisibleConsole.fallBackIFrame.style.display='none';VisibleConsole.fallBackIFrame.id='visibleconsoleiframe';n.body.appendChild(VisibleConsole.fallBackIFrame)}VisibleConsole.browserVisibleConsole=VisibleConsole.fallBackIFrame.contentWindow.console;if(Function.prototype.bind&&VisibleConsole.browserVisibleConsole&&typeof VisibleConsole.browserVisibleConsole.log=="object"){VisibleConsole.browserLog=Function.prototype.bind.call(VisibleConsole.browserVisibleConsole.log,VisibleConsole.browserVisibleConsole)}m.console={log:function(){var a="<span class='visibleconsolemessage'>",strArg;for(var i=0;i<arguments.length;++i){if(typeof(arguments[i])=='string'){a+=arguments[i]}else{try{strArg=JSON.stringify(arguments[i]);a+=strArg}catch(e){strArg=Object.prototype.toString.call(arguments[i]);a+=strArg}}if(i<arguments.length-1)a+=' ';else a+="\n"}a+="</span>";VisibleConsole.consoleOutputEl.innerHTML+=a;VisibleConsole.consoleOutputEl.scrollTop=VisibleConsole.consoleOutputEl.scrollHeight;if(VisibleConsole.browserLog&&VisibleConsole.browserVisibleConsole&&VisibleConsole.browserVisibleConsole.log){VisibleConsole.browserLog.apply(null,arguments)}}};m.onerror=function(a,b,c){m.console.log('<span class="visibleconsoleerror">[ERROR] '+a+' ('+b+' Line: '+c+')</span>');return true};VisibleConsole._resize()}};VisibleConsole.disable=function(){if(VisibleConsole._isEnabled===true){VisibleConsole._isEnabled=false;m.console=VisibleConsole.browserVisibleConsole;m.onerror=VisibleConsole.fallBackIFrame.contentWindow.onerror;VisibleConsole.consoleEl.parentNode.removeChild(VisibleConsole.consoleEl);VisibleConsole.fallBackIFrame.parentNode.removeChild(VisibleConsole.fallBackIFrame);VisibleConsole.consoleEl=null;VisibleConsole.fallBackIFrame=null;VisibleConsole.browserLog=null}};VisibleConsole._createline=function(a,b,c,d){var e=navigator.userAgent.indexOf("MSIE")>-1;if(c<a){var f=a;a=c;c=f;f=b;b=d;d=f}var g=n.createElement("div");g.className="visibleconsoleline";var h=Math.sqrt((a-c)*(a-c)+(b-d)*(b-d));g.style.width=h+"px";if(e){g.style.top=(d>b)?b+"px":d+"px";g.style.left=a+"px";var i=(c-a)/h;var j=(d-b)/h;g.style.filter="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+i+", M12="+ -1*j+", M21="+j+", M22="+i+")"}else{var k=Math.atan((d-b)/(c-a));g.style.top=b+0.5*h*Math.sin(k)+"px";g.style.left=a-0.5*h*(1-Math.cos(k))+"px";g.style.MozTransform=g.style.WebkitTransform=g.style.OTransform="rotate("+k+"rad)"}return g};VisibleConsole._stop=function(){n.onmouseup=function(){};n.onmousemove=function(){};n.ontouchend=function(){};n.ontouchmove=function(){}};VisibleConsole._move=function(a,b){VisibleConsole.consoleEl.style.left=Math.max(a,0)+'px';VisibleConsole.consoleEl.style.top=Math.max(b,0)+'px'};VisibleConsole._resize=function(w,h){if(w!==null&&h!==null){VisibleConsole.consoleEl.style.pixelWidth=w;VisibleConsole.consoleEl.style.pixelHeight=h;VisibleConsole.consoleEl.style.width=w+'px';VisibleConsole.consoleEl.style.height=h+'px'}var a=VisibleConsole.consoleInnerEl.offsetHeight;var b=VisibleConsole.headerEl.offsetHeight;var c=VisibleConsole.consoleInputEl.offsetHeight;var d=(a-b-c);VisibleConsole.consoleOutputEl.style.height=d+'px'};VisibleConsole._startMoving=function(d){d=d||m.event;if((d.keyCode||d.which)==3)return;VisibleConsole._stopDefault(d);var e=d.clientX;var f=d.clientY;var g=Number(VisibleConsole.consoleEl.style.top.replace('px',''));var h=Number(VisibleConsole.consoleEl.style.left.replace('px',''));var i=e-h;var j=f-g;n.onmousemove=function(a){VisibleConsole._stopDefault(a);a=a||m.event;var b=a.clientX-i;var c=a.clientY-j;VisibleConsole._move(b,c)};n.onmouseup=n.ontouchend=VisibleConsole._stop};VisibleConsole._startTouchMoving=function(e){e=e||m.event;VisibleConsole._stopDefault(e);var f=(typeof(e.touches)!=='undefined')?e.touches[0]:null;if(f!==null){var g=f.clientX;var h=f.clientY;var i=Number(VisibleConsole.consoleEl.style.top.replace('px',''));var j=Number(VisibleConsole.consoleEl.style.left.replace('px',''));var k=g-j;var l=h-i;n.ontouchmove=function(a){VisibleConsole._stopDefault(a);a=a||m.event;var b=(typeof(a.touches)!=='undefined')?a.touches[0]:null;if(b!==null){var c=b.clientX-k;var d=b.clientY-l;VisibleConsole._move(c,d)}};n.ontouchend=VisibleConsole._stop}};VisibleConsole._startResizing=function(d){d=d||m.event;if((d.keyCode||d.which)==3)return;VisibleConsole._stopDefault(d);var e=d.clientX;var f=d.clientY;var g=Number(VisibleConsole.consoleEl.style.top.replace('px',''));var h=Number(VisibleConsole.consoleEl.style.left.replace('px',''));n.onmousemove=function(a){a=a||m.event;VisibleConsole._stopDefault(a);var b=a.clientX-h;var c=a.clientY-g;VisibleConsole._resize(b,c)};n.onmouseup=VisibleConsole._stop};VisibleConsole._startTouchResizing=function(e){e=e||m.event;VisibleConsole._stopDefault(e);var f=(typeof(e.touches)!=='undefined')?e.touches[0]:null;if(f!==null){var g=f.clientX;var h=f.clientY;var i=Number(VisibleConsole.consoleEl.style.top.replace('px',''));var j=Number(VisibleConsole.consoleEl.style.left.replace('px',''));n.ontouchmove=function(a){a=a||m.event;VisibleConsole._stopDefault(a);var b=(typeof(a.touches)!=='undefined')?a.touches[0]:null;if(b!==null){var c=b.clientX-j;var d=b.clientY-i}VisibleConsole._resize(c,d)};n.ontouchend=VisibleConsole._stop}};VisibleConsole._stopDefault=function(a){a=a||m.event;if(a&&a.preventDefault){a.preventDefault()}else{m.event.returnValue=false}return false};VisibleConsole._keyPress=function(a){a=a||m.event;var b=a?(a.which?a.which:a.keyCode):event.keyCode;if(b==13){var c=event.target.value;event.target.value="";eval(c)}else return true};m.VisibleConsole=VisibleConsole})(window,document);
