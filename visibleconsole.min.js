/*!
 * VisibleConsole v0.4.1
 * http://github.com/jamestomasino/visibleconsole.js
 *
 * Copyright (c) James Tomasino
 *               Eric Emmons
 *               Stephen McDonald
 * MIT license
 *
 */

(function(m,n,o){"use strict";function VC(){}VC._fallbackConsole;VC._passiveOutput;VC._isEnabled=false;VC._isPassiveLogging=false;VC._commandHistory=[];VC._commandIndex=0;VC.el={};VC.el.console;VC.el.header;VC.el.inner;VC.el.container;VC.el.output;VC.el.input;VC.el.handle;VC.enable=function(){if(VC._isEnabled===false){VC._isEnabled=true;VC.el.console=n.getElementById('visibleconsole');if(!VC.el.console){VC.el.console=n.createElement('div');VC.el.console.id='visibleconsole';n.body.appendChild(VC.el.console)}VC.el.header=n.getElementById('visibleconsoleheader');if(!VC.el.header){VC.el.header=n.createElement('div');VC.el.header.id='visibleconsoleheader';VC.el.header.innerHTML='~VisibleConsole~';VC.el.header.onmousedown=VC._startMoving;VC.el.header.ontouchstart=VC._startTouchMoving;n.getElementById('visibleconsole').appendChild(VC.el.header)}VC.el.inner=n.getElementById('visibleconsoleinner');if(!VC.el.inner){VC.el.inner=n.createElement('div');VC.el.inner.id='visibleconsoleinner';n.getElementById('visibleconsole').appendChild(VC.el.inner)}VC.el.container=n.getElementById('visibleconsolecontainer');if(!VC.el.container){VC.el.container=n.createElement('div');VC.el.container.id='visibleconsolecontainer';n.getElementById('visibleconsoleinner').appendChild(VC.el.container)}VC.el.output=n.getElementById('visibleconsoleoutput');if(!VC.el.output){VC.el.output=n.createElement('div');VC.el.output.id='visibleconsoleoutput';n.getElementById('visibleconsolecontainer').appendChild(VC.el.output)}VC.el.input=n.getElementById('visibleconsoleinput');if(!VC.el.input){VC.el.input=n.createElement('input');VC.el.input.id='visibleconsoleinput';VC.el.input.onkeypress=VC._keyPress;VC.el.input.onkeydown=VC._keyDown;n.getElementById('visibleconsolecontainer').appendChild(VC.el.input)}VC.el.handle=n.getElementById('visibleconsolehandle');if(!VC.el.handle){VC.el.handle=n.createElement('div');VC.el.handle.id='visibleconsolehandle';VC.el.handle.onmousedown=VC._startResizing;VC.el.handle.ontouchstart=VC._startTouchResizing;n.getElementById('visibleconsole').appendChild(VC.el.handle);var e=VC.el.handle.offsetWidth;var f=VC.el.handle.offsetHeight;VC.el.handle.appendChild(VC._createline(e+1,f-5,e-4,f));VC.el.handle.appendChild(VC._createline(e+1,f-11,e-10,f))}if(!VC._fallbackConsole)VC._fallbackConsole=m.console;if(VC._passiveOutput){VC.el.output.innerHTML=VC._passiveOutput.innerHTML;VC.el.output.scrollTop=VC.el.output.scrollHeight}m.console={log:function(){var a=VC._createLogMessage(arguments);VC.el.output.appendChild(a);VC.el.output.scrollTop=VC.el.output.scrollHeight;if(VC._fallbackConsole.log)VC._fallbackConsole.log.apply(VC._fallbackConsole,arguments)}};m.onerror=function(a,b,c){var d=VC._createErrorMessage(a,b,c);VC.el.output.appendChild(d);VC.el.output.scrollTop=VC.el.output.scrollHeight;return false};VC._resize();VC._move()}};VC.disable=function(){if(VC._isEnabled===true){VC._isEnabled=false;if(VC._isPassiveLogging===true){VC._enablePassiveLogger();if(VC.el.output)VC._passiveOutput.innerHTML=VC.el.output.innerHTML}else{m.console=VC._fallbackConsole;VC._fallbackConsole=null}VC.el.console.parentNode.removeChild(VC.el.console);VC.el.console=null}};VC.enablePassiveLogging=function(){if(VC._isPassiveLogging===false){VC._isPassiveLogging=true;if(!VC._fallbackConsole)VC._fallbackConsole=m.console;if(VC._isEnabled!==true){VC._enablePassiveLogger()}}};VC.disablePassiveLogging=function(){if(VC._isPassiveLogging===true){VC._isPassiveLogging=false;VC._passiveOutput=null;if(VC._isEnabled!==true){m.console=VC._fallbackConsole;VC._fallbackConsole=null}}};VC._enablePassiveLogger=function(){VC._passiveOutput=n.createElement('div');m.console={log:function(){var a=VC._createLogMessage(arguments);VC._passiveOutput.appendChild(a);if(VC._fallbackConsole.log)VC._fallbackConsole.log.apply(VC._fallbackConsole,arguments)}};m.onerror=function(a,b,c){var d=VC._createErrorMessage(a,b,c);VC._passiveOutput.appendChild(d);return false}};VC._createLogMessage=function(a){var b=n.createElement('span');var c;b.className='visibleconsolemessage';for(var i=0;i<a.length;++i){if(typeof(a[i])=='string'){c=n.createTextNode(a[i]);b.appendChild(c)}else{try{c=n.createTextNode(JSON.stringify(a[i]));b.appendChild(c)}catch(e){c=n.createTextNode(Object.prototype.toString.call(a[i]));b.appendChild(c)}}if(i<a.length-1)b.appendChild(n.createTextNode(' '))}return b};VC._createErrorMessage=function(a,b,c){var d=n.createElement('span');d.className='visibleconsolemessage';var e=n.createElement('span');e.className='visibleconsoleerror';var f=n.createTextNode('[ERROR] '+a+' ('+b+' Line: '+c+')');e.appendChild(f);d.appendChild(e);return d};VC._createline=function(a,b,c,d){var e=o.userAgent.indexOf("MSIE")>-1;if(c<a){var f=a;a=c;c=f;f=b;b=d;d=f}var g=n.createElement("div");g.className="visibleconsoleline";var h=Math.sqrt((a-c)*(a-c)+(b-d)*(b-d));g.style.width=h+"px";if(e){g.style.top=(d>b)?b+"px":d+"px";g.style.left=a+"px";var i=(c-a)/h;var j=(d-b)/h;g.style.filter="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+i+", M12="+ -1*j+", M21="+j+", M22="+i+")"}else{var k=Math.atan((d-b)/(c-a));g.style.top=b+0.5*h*Math.sin(k)+"px";g.style.left=a-0.5*h*(1-Math.cos(k))+"px";g.style.MozTransform=g.style.WebkitTransform=g.style.OTransform="rotate("+k+"rad)"}return g};VC._stop=function(){n.onmouseup=function(){};n.onmousemove=function(){};n.ontouchend=function(){};n.ontouchmove=function(){}};VC._move=function(a,b){if(typeof a==="undefined"||typeof b==="undefined"){var c=(n.compatMode==="CSS1Compat")?n.documentElement:n.body;var d=c.clientHeight;var e=c.clientWidth;var f=VC.el.inner.offsetHeight;var g=VC.el.inner.offsetWidth;a=(e>>1)-(g>>1);b=(d>>1)-(f>>1)}VC.el.console.style.left=Math.max(a,0)+'px';VC.el.console.style.top=Math.max(b,0)+'px'};VC._resize=function(w,h){if(typeof w!=="undefined"&&typeof h!=="undefined"){VC.el.console.style.pixelWidth=w;VC.el.console.style.pixelHeight=h;VC.el.console.style.width=w+'px';VC.el.console.style.height=h+'px'}var a=VC.el.inner.offsetHeight;var b=VC.el.header.offsetHeight;var c=VC.el.input.offsetHeight;var d=(a-b-c);VC.el.output.style.height=d+'px'};VC._startMoving=function(d){d=d||m.event;if((d.keyCode||d.which)==3)return;VC._stopDefault(d);var e=d.clientX;var f=d.clientY;var g=Number(VC.el.console.style.top.replace('px',''));var h=Number(VC.el.console.style.left.replace('px',''));var i=e-h;var j=f-g;n.onmousemove=function(a){VC._stopDefault(a);a=a||m.event;var b=a.clientX-i;var c=a.clientY-j;VC._move(b,c)};n.onmouseup=n.ontouchend=VC._stop};VC._startTouchMoving=function(e){e=e||m.event;VC._stopDefault(e);var f=(typeof(e.touches)!=='undefined')?e.touches[0]:null;if(f!==null){var g=f.clientX;var h=f.clientY;var i=Number(VC.el.console.style.top.replace('px',''));var j=Number(VC.el.console.style.left.replace('px',''));var k=g-j;var l=h-i;n.ontouchmove=function(a){VC._stopDefault(a);a=a||m.event;var b=(typeof(a.touches)!=='undefined')?a.touches[0]:null;if(b!==null){var c=b.clientX-k;var d=b.clientY-l;VC._move(c,d)}};n.ontouchend=VC._stop}};VC._startResizing=function(d){d=d||m.event;if((d.keyCode||d.which)==3)return;VC._stopDefault(d);var e=d.clientX;var f=d.clientY;var g=Number(VC.el.console.style.top.replace('px',''));var h=Number(VC.el.console.style.left.replace('px',''));n.onmousemove=function(a){a=a||m.event;VC._stopDefault(a);var b=a.clientX-h;var c=a.clientY-g;VC._resize(b,c)};n.onmouseup=VC._stop};VC._startTouchResizing=function(e){e=e||m.event;VC._stopDefault(e);var f=(typeof(e.touches)!=='undefined')?e.touches[0]:null;if(f!==null){var g=f.clientX;var h=f.clientY;var i=Number(VC.el.console.style.top.replace('px',''));var j=Number(VC.el.console.style.left.replace('px',''));n.ontouchmove=function(a){a=a||m.event;VC._stopDefault(a);var b=(typeof(a.touches)!=='undefined')?a.touches[0]:null;if(b!==null){var c=b.clientX-j;var d=b.clientY-i}VC._resize(c,d)};n.ontouchend=VC._stop}};VC._stopDefault=function(a){a=a||m.event;if(a&&a.preventDefault){a.preventDefault()}else{m.event.returnValue=false}return false};VC._keyDown=function(a){a=a||m.event;var b=a?(a.which?a.which:a.keyCode):event.keyCode;switch(b){case 38:if(VC._commandIndex>0){--VC._commandIndex;var c=VC._commandHistory[VC._commandIndex];VC.el.input.value=c}a.preventDefault();break;case 40:if(VC._commandIndex<VC._commandHistory.length-1){++VC._commandIndex;var c=VC._commandHistory[VC._commandIndex];VC.el.input.value=c}a.preventDefault();break}}VC._keyPress=function(a){a=a||m.event;var b=a?(a.which?a.which:a.keyCode):event.keyCode;switch(b){case 13:var c=event.target.value;event.target.value="";VC._commandHistory.push(c);VC._commandIndex=VC._commandHistory.length;switch(c){case'clear':if(VC._passiveOutput)VC._passiveOutput.innerHTML='';if(VC.el.output)VC.el.output.innerHTML='';break;default:eval(c)}break;default:return true}};m.VisibleConsole=VC})(window,document,navigator);
